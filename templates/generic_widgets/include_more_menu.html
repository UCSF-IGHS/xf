{% load dashgent_filters %}

<ul class="nav navbar-right panel_toolbox">

    {# Spanner dropdown. Only available to admins #}
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
           aria-expanded="false"><i
                class="fa fa-wrench"></i></a>
        <ul class="dropdown-menu" role="menu">
           {% if request.user.is_superuser %}
                {% if change_url %}
                    <li><a href="{{ change_url }}" target="_blank">Edit widget</a></li>
                {% endif %}
            {% endif %}
            {% if widget.slug %}
            <li><a href="{% url 'widgets' widget.slug %}{{ filter_query_string }}" target="_blank">View as stand-alone</a></li>
            {% endif %}
        </ul>
    </li>

    {# Data Dropdown #}
    {% if supports_view_data or  widget.view_details_url or widget.user_description or custom_attr|lookup:'dynamic' == 'yes' %}
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
           aria-expanded="false">Data <i
                class="fa fa-chevron-down"></i></a>
        <ul class="dropdown-menu" role="menu">
            {% if supports_view_data %}
                <li><a href="#" data-toggle="modal" data-target="#{{ widget_id }}-modal">View data</a>
            {% endif %}
            </li>
            {% if widget.view_details_url %}
                <li><a href="{{ widget.view_details_url }}{{ filter_query_string }}" target="_blank">View details</a>
                </li>
            {% endif %}
            {% if supports_view_data and custom_attr|lookup:'allow_downloads' == 'yes'%}
            <li role="presentation" class="divider"></li>
            {% endif %}
            <li id="{{ widget_id }}_export_copy"></li>
            <li id="{{ widget_id }}_export_csv"></li>
            <li id="{{ widget_id }}_export_pdf"></li>
            <li id="{{ widget_id }}_export_print"></li>
            {%  if widget.user_description  %}
            <li role="presentation" class="divider"></li>
            <li><a href="#" data-toggle="modal" role="button"
           data-target="#{{ widget_id }}-modal-about">More info</a></li>
            {% endif %}


        </ul>
        {% endif %}
    </li>


</ul>


<div class="modal fade bs-example-modal-md" id="{{ widget_id }}-modal-about" tabindex="-1" role="dialog"
     aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">More information</h4>
            </div>
            <div class="modal-body">
                <div>
                    {{ widget.user_description|safe }}
                </div>
                <p/>
                <p>{{ widget.code }}</p>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
